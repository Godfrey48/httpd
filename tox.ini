[tox]
envlist =
    {py27}-{ansible21,ansible20,ansible19}

skipsdist = True


[testenv]
changedir = tests

deps =
    ansible21: ansible==2.1.*
    ansible20: ansible==2.0.*
    ansible19: ansible==1.9.*

passenv = ANSIBLE_ASK_SUDO_PASS HOME LANG LC_ALL

commands =
    bash -c "test -s ../requirements.yml && ansible-galaxy install --force -r ../requirements.yml --roles-path=dependencies || true"
    bash vagrant.sh {posargs}

whitelist_externals =
    bash


[testenv:travis]
passenv = ANSIBLE_ASK_SUDO_PASS HOME TRAVIS

commands =
    bash -c "test -s ../requirements.yml && ansible-galaxy install --force -r ../requirements.yml --roles-path=dependencies || true"
    ansible-playbook -i localhost, --connection=local test.yml -e vagrant_box=localhost {posargs} -e env=travis --skip-tags=test
    bash test_checkmode.sh --env travis
    bash test_idempotence.sh --env travis

whitelist_externals =
    ansible-playbook
    bash

