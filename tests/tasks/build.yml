---
# file: apache/tests/tasks/build.yml
#
# Test tasks to verify build.
#

- name: build | are apache build dependencies installed?
  command: "dpkg-query -W -f='${Status}\n' {{ item }}"
  register: test
  failed_when: test.stdout.find('install ok installed') == -1
  with_items: "{{ apache_build_dependencies }}"
  changed_when: no

- name: build | file(s) are present?
  command: "test -e {{ item }}"
  with_items:
    - "{{ apache_dir_source }}/{{ apache_tarball }}"
    - "{{ apache_dir_source }}/{{ apache_tarball }}.md5"
  changed_when: no

- name: build | directory(ies) are present?
  command: "test -d {{ apache_dir_source }}/{{ item }}"
  with_items:
    - ''
    - "httpd-{{ apache_version }}"
  changed_when: no

- name: build | symlink(s) are present?
  command: "test -h {{ item }}"
  with_items:
    - apache_dir
    - apache_dir_modules
