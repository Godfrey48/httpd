---
# file: apache/tests/tasks/build.yml
#
# Test tasks to verify build.
#

- name: build | are apache build dependencies installed?
  command: "dpkg-query -W -f='${Status}\n' {{ item }}"
  register: test
  failed_when: test.stdout.find('install ok installed') == -1
  with_items: "{{ httpd_build_dependencies }}"
  changed_when: no

- name: build | file(s) are present?
  command: "test -e {{ item }}"
  with_items:
    - "{{ httpd_dir_source }}/{{ httpd_tarball }}"
    - "{{ httpd_dir_source }}/{{ httpd_tarball }}.md5"
  changed_when: no

- name: build | directory(ies) are present?
  command: "test -d {{ httpd_dir_source }}/{{ item }}"
  with_items:
    - ''
    - "httpd-{{ httpd_version }}"
  changed_when: no

- name: build | symlink(s) are present?
  command: "test -h {{ item }}"
  with_items:
    - "{{ httpd_dir }}"
    - "{{ httpd_dir_modules }}"
  changed_when: no
