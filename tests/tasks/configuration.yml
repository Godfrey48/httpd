---
# file: apache/tests/tasks/configuration.yml
#
# Test tasks to verify configuration.
#

- name: configuration | directory(ies) are present?
  command: "test -d {{ apache_dir_configuration }}/{{ item }}"
  with_items:
    - ''
    - /conf-available
    - /mods-available
    - /mods-enabled
    - /sites-available
    - /sites-enabled
  become: yes
  changed_when: no

- name: copy to server expected configuration
  copy:
    src=files/etc/default/apache2
    dest=/tmp/etc_default_apache2.expected
    owner="{{ apache_user.name }}"
    group="{{ apache_user.name }}"
    mode=0644
  become: yes
  changed_when: no

- name: ensure config was generated as expected
  command: diff -q -w /etc/default/apache2 /tmp/etc_default_apache2.expected
  become: yes
  changed_when: no

- name: copy to server expected envvars file
  copy:
    src=files/etc/apache2/envvars
    dest=/tmp/etc_apache2_envvars.expected
    owner="{{ apache_user.name }}"
    group="{{ apache_user.name }}"
    mode=0644
  become: yes
  changed_when: no

- name: ensure config was generated as expected
  command: diff -q -w /etc/apache2/envvars /tmp/etc_apache2_envvars.expected
  become: yes
  changed_when: no
