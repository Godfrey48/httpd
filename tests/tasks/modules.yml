---
# file: apache/tests/tasks/modules.yml
#
# Test tasks to verify modules configuration.
#

#    - httpd_dir_cache
#    - httpd_dir_log

- name: modules | load files are present?
  command: "test -e {{ httpd_dir_configuration }}/mods-available/{{ item }}.load"
  with_items: "{{ httpd_modules }}"
  changed_when: no

- name: copy to server expected module configuration
  copy:
    src="files/{{ item }}"
    dest="/tmp/{{ item.replace('/', '_') }}.expected"
    owner="{{ httpd_user.name }}"
    group="{{ httpd_user.name }}"
    mode=0644
  become: yes
  with_items:
    - etc/httpd/mods-enabled/status.load
    - etc/httpd/mods-enabled/status.conf
  changed_when: no

- name: ensure config was generated as expected
  command: "diff -q -w /{{ item }} /tmp/{{ item.replace('/', '_') }}.expected"
  become: yes
  with_items:
    - etc/httpd/mods-enabled/status.load
    - etc/httpd/mods-enabled/status.conf
  changed_when: no
