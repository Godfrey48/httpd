---
# file: apache/tests/test.yml

- name: setup python2
  hosts: "{{ vagrant_box }}"
  gather_facts: no

  tasks:
    - raw: sudo apt-get update -qq && sudo apt-get install -qq python2.7
      when: playbook_python2 is defined and
            playbook_python2


- name: tests play
  hosts: "{{ vagrant_box }}"
  gather_facts: yes

  vars:
    debug: yes

    apache_default: |
      ### htcacheclean settings ###

      ## run htcacheclean: yes, no, auto
      ## auto means run if {{ apache_dir_configuration }}/mods-enabled/cache_disk.load exists
      ## default: auto
      HTCACHECLEAN_RUN=auto

      ## run mode: cron, daemon
      ## run in daemon mode or as daily cron job
      ## default: daemon
      HTCACHECLEAN_MODE=daemon

      ## cache size
      HTCACHECLEAN_SIZE=300M

      ## interval: if in daemon mode, clean cache every x minutes
      HTCACHECLEAN_DAEMON_INTERVAL=120

      ## path to cache
      ## must be the same as in CacheRoot directive
      HTCACHECLEAN_PATH={{ apache_dir_cache }}/mod_cache_disk

      ## additional options:
      ## -n : be nice
      ## -t : remove empty directories
      HTCACHECLEAN_OPTIONS="-n"

  pre_tasks:
    - include_vars: "vars/{{ env }}.yml"

  roles:
    - role: apache

    - role: tests
      tags: test

